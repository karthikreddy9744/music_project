<style>
    .chat-widget-container { position: fixed; bottom: 20px; right: 20px; z-index: 1000; }
    .chat-widget-icon {
        background-color: #1DB954;
        background: linear-gradient(45deg, #1DB954, #1ed760);
        color: white;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        font-size: 26px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        transition: transform 0.2s ease;
        transition: transform 0.2s ease, background-color 0.3s ease;
    }
    .chat-widget-icon:hover { transform: scale(1.1); }
    .chat-widget-icon:hover { transform: scale(1.1); background-color: #1ed760; }
    .chat-widget-window {
        position: absolute;
        bottom: 80px;
        right: 0;
        width: 350px;
        width: 370px;
        max-width: 90vw;
        background-color: #282828;
        border-radius: 10px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.4);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: opacity 0.3s ease, transform 0.3s ease;
        transform-origin: bottom right;
    }
    .chat-widget-window.ng-hide {
        opacity: 0;
        transform: scale(0.9);
    }
    .chat-widget-header {
        background-color: #191919;
        color: white;
        padding: 12px 15px;
        font-weight: bold;
        font-size: 16px;
        border-bottom: 1px solid #444;
    }
    .chat-widget-body { height: 45vh; overflow-y: auto; padding: 15px; }
    .chat-widget-footer { padding: 10px; border-top: 1px solid #444; background-color: #191919; }
    .chat-widget-footer .form-control { border-radius: 20px; background-color: #3e3e3e; border-color: #555; color: #fff; }

    /* Message Styling */
    .message.user { background-color: #005c97; color: white; margin-left: auto; text-align: left; }
    .message.model { background-color: #3a3a3a; color: #e0e0e0; margin-right: auto; }
</style>

<div class="chat-widget-container">
    <!-- Chat Window -->
    <div class="chat-widget-window" ng-show="chatvm.isOpen">
        <div class="chat-widget-header">AI Assistant</div>
        <div class="chat-widget-body">
            <div ng-repeat="msg in chatvm.messages track by $index" class="message" ng-class="msg.role">
                <p style="white-space: pre-wrap; margin: 0;">{{ msg.text }}</p>
            </div>
            <div ng-if="chatvm.isLoading" class="message model loading-dots"><span></span><span></span><span></span></div>
        </div>
        <div class="chat-widget-footer">
            <form ng-submit="chatvm.sendMessage()"><input type="text" class="form-control" placeholder="Ask a question..." ng-model="chatvm.newMessage" ng-disabled="chatvm.isLoading"></form>
        </div>
    </div>

    <!-- Toggle Icon -->
    <div class="chat-widget-icon" ng-click="chatvm.toggleChat()">
        <i class="glyphicon" ng-class="{'glyphicon-comment': !chatvm.isOpen, 'glyphicon-remove': chatvm.isOpen}"></i>
    </div>
</div>