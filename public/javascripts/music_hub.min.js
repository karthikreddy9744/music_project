!function(){"use strict";function e(e){return{request:function(t){const i=e.getToken();return i&&(t.headers=t.headers||{},t.headers.Authorization="Bearer "+i),t}}}angular.module("musicProjectApp",["ngRoute"]).config(["$routeProvider","$locationProvider","$httpProvider",function(e,t,i){t.html5Mode(!0).hashPrefix(""),i.interceptors.push("authInterceptor");const n=["authService","$location",function(e,t){return!!e.isAdmin()||(t.path("/"),!1)}],r=["authService","$location",function(e,t){return!!e.isAuthenticated()||(t.path("/login"),!1)}];e.when("/",{templateUrl:"components/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/festivals/:festivalid",{templateUrl:"components/festivals/festivalDetail.view.html",controller:"festivalDetailCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"components/auth/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"components/auth/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/festivals/add",{templateUrl:"components/festivals/festivalForm.view.html",controller:"festivalFormCtrl",controllerAs:"vm",resolve:{adminCheck:n}}).when("/festivals/:festivalid/edit",{templateUrl:"components/festivals/festivalForm.view.html",controller:"festivalFormCtrl",controllerAs:"vm",resolve:{adminCheck:n}}).when("/reviews/add",{templateUrl:"components/reviews/reviewForm.view.html",controller:"reviewFormCtrl",controllerAs:"vm",resolve:{authCheck:r}}).when("/reviews/:reviewid/edit",{templateUrl:"components/reviews/reviewForm.view.html",controller:"reviewFormCtrl",controllerAs:"vm",resolve:{authCheck:r}}).when("/news",{templateUrl:"components/news/newsList.view.html",controller:"newsListCtrl",controllerAs:"vm"}).when("/news/add",{templateUrl:"components/news/newsForm.view.html",controller:"newsFormCtrl",controllerAs:"vm",resolve:{adminCheck:n}}).when("/news/:newsid",{templateUrl:"components/news/newsDetail.view.html",controller:"newsDetailCtrl",controllerAs:"vm"}).when("/news/:newsid/edit",{templateUrl:"components/news/newsForm.view.html",controller:"newsFormCtrl",controllerAs:"vm",resolve:{adminCheck:n}}).when("/admin/stats",{templateUrl:"components/admin/adminStats.view.html",controller:"adminStatsCtrl",controllerAs:"vm",resolve:{adminCheck:n}}).otherwise({redirectTo:"/"})}]),angular.module("musicProjectApp").factory("authInterceptor",e),e.$inject=["authService"]}(),function(){"use strict";function e(e){this.getStats=function(){return e.get("/api/admin/stats")}}angular.module("musicProjectApp").service("adminData",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){var t="music_project_token";this.saveToken=function(i){i?e.localStorage.setItem(t,i):e.localStorage.removeItem(t)},this.getToken=function(){return e.localStorage.getItem(t)},this.logout=function(){e.localStorage.removeItem(t)},this.parseToken=function(){const e=this.getToken();if(!e)return null;try{var t=e.split(".")[1];return t=t.replace(/-/g,"+").replace(/_/g,"/"),t=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),JSON.parse(t)}catch(e){return null}},this.getRole=function(){const e=this.parseToken();return e&&e.user&&e.user.roles&&e.user.roles.length?e.user.roles[0].name:null},this.isAdmin=function(){const e=this.parseToken();return e&&e.user&&e.user.roles&&e.user.roles.some(e=>"admin"===e.name)},this.isAuthenticated=function(){return!!this.getToken()}}angular.module("musicProjectApp").service("authService",e),e.$inject=["$window"]}(),function(){"use strict";function e(e){const t="/api/festivals";this.getFestivals=function(){return e.get(t)},this.getFestivalById=function(i){return e.get(t+"/"+i)},this.addFestival=function(i){return e.post(t,i)},this.updateFestival=function(i,n){return e.put(t+"/"+i,n)},this.deleteFestival=function(i){return e.delete(t+"/"+i)}}angular.module("musicProjectApp").service("festivalsData",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){const t="/api/reviews",i="/api/news";this.getReviewsList=function(){return e.get(t)},this.addReview=function(i){return e.post(t,i)},this.getReviewById=function(i){return e.get(t+"/"+i)},this.updateReview=function(i,n){return e.put(t+"/"+i,n)},this.deleteReview=function(i){return e.delete(t+"/"+i)},this.getNewsList=function(){return e.get(i)},this.getNewsById=function(t){return e.get(i+"/"+t)},this.addNews=function(t){return e.post(i,t)},this.updateNews=function(t,n){return e.put(i+"/"+t,n)},this.deleteNews=function(t){return e.delete(i+"/"+t)}}angular.module("musicProjectApp").service("reviewsNewsData",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){const t="/api";this.getProfile=function(){return e.get(t+"/auth/me")},this.updateProfile=function(i){return e.put(t+"/users/me",i)},this.getAllUsers=function(){return e.get(t+"/users")}}angular.module("musicProjectApp").service("userData",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){return{restrict:"E",scope:{location:"=location"},template:'<div id="mapid" style="height: 350px; width: 100%;"></div>',link:function(t,i,n){var r=null,a=null;const o=[17.385044,78.486671];function s(i,n){e(function(){r&&r.remove(),r=L.map("mapid").setView([i,n],13),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(r),(a=L.marker([i,n],{draggable:!0,title:"Drag to set location"}).addTo(r)).on("dragend",function(){const e=a.getLatLng();t.$apply(function(){t.location.longitude=e.lng,t.location.latitude=e.lat})})},0)}t.$watch("location",function(e){if(e&&"number"==typeof e.latitude&&"number"==typeof e.longitude){const t=e.latitude,i=e.longitude;r?(r.setView([t,i],r.getZoom()),a.setLatLng([t,i])):s(t,i)}else r||s(o[0],o[1])},!0)}}}angular.module("musicProjectApp").directive("leafletMap",e),e.$inject=["$timeout"]}(),function(){"use strict";angular.module("musicProjectApp").directive("navigation",function(){return{restrict:"EA",templateUrl:"components/shared/navigation.view.html",controller:"navigationCtrl",controllerAs:"navvm"}})}(),function(){"use strict";angular.module("musicProjectApp").directive("starRating",function(){return{restrict:"EA",scope:{ratingValue:"=ratingValue"},template:'<span ng-repeat="star in vm.stars" ng-click="vm.toggle($index)"><i class="glyphicon" ng-class="{\'glyphicon-star\': star.filled, \'glyphicon-star-empty\': !star.filled}"></i></span>',controller:function(e){var t=this;function i(){t.stars.length=0;for(let i=0;i<5;i++)t.stars.push({filled:i<e.ratingValue})}t.stars=[],t.toggle=function(t){e.ratingValue=t+1},e.$watch("ratingValue",function(e,t){t!==e&&i()}),i()},controllerAs:"vm"}})}(),function(){"use strict";function e(e,t,i){var n=this;n.credentials={},n.error=null,n.login=function(){n.error=null,n.credentials.email&&n.credentials.password?e.post("/api/auth/login",n.credentials).then(function(e){e.data&&e.data.token?(i.saveToken(e.data.token),t.path("/")):n.error="Login failed: No token received."}).catch(function(e){n.error=e.data&&e.data.message||"Login failed due to a server error."}):n.error="All fields are required."}}angular.module("musicProjectApp").controller("loginCtrl",e),e.$inject=["$http","$location","authService"]}(),function(){"use strict";function e(e,t,i){var n=this;n.credentials={},n.error=null,n.register=function(){n.error=null,n.credentials.name&&n.credentials.email&&n.credentials.password?e.post("/api/auth/register",n.credentials).then(function(e){e.data&&e.data.token?(i.saveToken(e.data.token),t.path("/")):t.path("/login")}).catch(function(e){n.error=e.data&&e.data.message||"Registration failed."}):n.error="All fields are required."}}angular.module("musicProjectApp").controller("registerCtrl",e),e.$inject=["$http","$location","authService"]}(),function(){"use strict";function e(e){var t=this;t.pageHeader={title:"Upcoming Music Festivals"},t.festivals=[],t.message="Loading festival list...",e.getFestivals().then(function(e){t.festivals=e.data,t.message=t.festivals.length>0?"":"No festivals found."}).catch(function(e){t.message="Error loading festival data.",console.error(e)})}angular.module("musicProjectApp").controller("homeCtrl",e),e.$inject=["festivalsData"]}(),function(){"use strict";function e(e){var t=this;t.pageHeader={title:"Admin Dashboard"},t.stats={},t.message="Loading stats...",e.getStats().then(function(e){t.stats=e.data,t.message=""}).catch(function(e){t.message="Failed to load admin stats. Check permissions.",console.error(e)})}angular.module("musicProjectApp").controller("adminStatsCtrl",e),e.$inject=["adminData"]}(),function(){"use strict";function e(e,t,i,n){var r=this;r.festivalid=e.festivalid,r.festival=null,r.message="Loading festival details...",r.isAdmin=n.isAdmin(),r.pageHeader={title:"Festival Details"},r.getFestival=function(){i.getFestivalById(r.festivalid).then(function(e){r.festival=e.data,r.pageHeader.title=r.festival.name,r.message=""}).catch(function(e){r.message="Sorry, couldn't load festival details.",console.error(e)})},r.deleteFestival=function(){r.isAdmin&&confirm("Are you sure you want to delete this festival?")&&i.deleteFestival(r.festivalid).then(()=>t.path("/")).catch(e=>{r.message="Error deleting festival.",console.error(e)})},r.getFestival()}angular.module("musicProjectApp").controller("festivalDetailCtrl",e),e.$inject=["$routeParams","$location","festivalsData","authService"]}(),function(){"use strict";function e(e,t,i){var n=this;n.festivalid=e.festivalid,n.isEdit=!!n.festivalid,n.message="",n.pageHeader={title:n.isEdit?"Edit Festival":"Add New Festival"},n.festival={name:"",address:"",description:"",startDate:new Date,endDate:new Date,location:{longitude:78.486671,latitude:17.385044}},n.isEdit&&i.getFestivalById(n.festivalid).then(function(e){n.festival=e.data,n.festival.startDate=new Date(n.festival.startDate),n.festival.endDate=new Date(n.festival.endDate)}).catch(function(e){n.message="Error loading festival data for editing.",console.error(e)}),n.saveFestival=function(){if(!(n.festival.name&&n.festival.address&&n.festival.startDate&&n.festival.endDate))return void(n.message="All main fields (Name, Address, Dates) are required.");if("number"!=typeof n.festival.location.latitude||"number"!=typeof n.festival.location.longitude)return void(n.message="Invalid location coordinates. Please confirm the pin on the map.");const e={name:n.festival.name,address:n.festival.address,description:n.festival.description,startDate:n.festival.startDate,endDate:n.festival.endDate,location:{longitude:n.festival.location.longitude,latitude:n.festival.location.latitude}};(n.isEdit?i.updateFestival(n.festivalid,e):i.addFestival(e)).then(function(e){t.path("/festivals/"+e.data._id)}).catch(function(e){n.message=e.data&&e.data.message||"Error saving festival.",console.error(e)})}}angular.module("musicProjectApp").controller("festivalFormCtrl",e),e.$inject=["$routeParams","$location","festivalsData"]}(),function(){"use strict";function e(e,t,i){var n=this;n.newsid=e.newsid,n.article=null,n.message="Loading article...",n.isAdmin=i.isAdmin(),n.pageHeader={title:"News Article"},t.getNewsById(n.newsid).then(function(e){n.article=e.data,n.pageHeader.title=n.article.title,n.message=""}).catch(function(e){n.message="Sorry, couldn't load the article.",console.error(e)})}angular.module("musicProjectApp").controller("newsDetailCtrl",e),e.$inject=["$routeParams","reviewsNewsData","authService"]}(),function(){"use strict";function e(e,t,i){var n=this;n.newsid=e.newsid,n.isEdit=!!n.newsid,n.message="",n.pageHeader={title:n.isEdit?"Edit News Article":"Create New News Article"},n.article={},n.isEdit&&i.getNewsById(n.newsid).then(function(e){n.article=e.data}).catch(function(e){n.message="Error loading article for editing.",console.error(e)}),n.saveNews=function(){if(!n.article.title||!n.article.body)return void(n.message="Title and content are required.");const e={title:n.article.title,body:n.article.body};(n.isEdit?i.updateNews(n.newsid,e):i.addNews(e)).then(function(){t.path("/news")}).catch(function(e){n.message=e.data&&e.data.message||"Error saving news article.",console.error(e)})}}angular.module("musicProjectApp").controller("newsFormCtrl",e),e.$inject=["$routeParams","$location","reviewsNewsData"]}(),function(){"use strict";function e(e,t){var i=this;i.pageHeader={title:"News and User Reviews"},i.contentList=[],i.message="Loading news and reviews...",i.isAdmin=t.isAdmin(),i.loadContent=function(){e.getReviewsList().then(function(e){i.contentList=e.data,i.message=i.contentList.length?"":"No news or reviews found."}).catch(function(e){i.message="Error loading content.",console.error(e)})},i.deleteContent=function(t,n){if(!i.isAdmin||!confirm("Are you sure you want to delete this "+n+"?"))return;("news"===n?e.deleteNews(t):e.deleteReview(t)).then(i.loadContent).catch(function(e){i.message="Error deleting content.",console.error(e)})},i.loadContent()}angular.module("musicProjectApp").controller("newsListCtrl",e),e.$inject=["reviewsNewsData","authService"]}(),function(){"use strict";function e(e,t,i,n){var r=this;r.reviewid=e.reviewid,r.isEdit=!!r.reviewid,r.review={rating:3,track:{}},r.formError="",r.pageHeader={title:r.isEdit?"Edit Review":"Post a New Review"},n.isAuthenticated()?(r.isEdit&&i.getReviewById(r.reviewid).then(function(e){r.review=e.data}).catch(function(e){r.formError="Error fetching review for editing.",console.error(e)}),r.saveReview=function(){if(!r.review.title||!r.review.body||!r.review.rating)return void(r.formError="Title, content, and rating are required.");const e={title:r.review.title,body:r.review.body,rating:r.review.rating,track:r.review.track};(r.isEdit?i.updateReview(r.reviewid,e):i.addReview(e)).then(function(){t.path("/news")}).catch(function(e){r.formError=e.data&&e.data.message||"Error saving review.",console.error(e)})}):t.path("/login")}angular.module("musicProjectApp").controller("reviewFormCtrl",e),e.$inject=["$routeParams","$location","reviewsNewsData","authService"]}(),function(){"use strict";function e(e,t){var i=this;i.isLoggedIn=function(){return e.isAuthenticated()},i.isAdmin=function(){return e.isAdmin()},i.currentUsername=function(){var t=e.parseToken();return t&&t.user&&t.user.email?t.user.email:"Profile"},i.logout=function(){e.logout(),t.path("/login")}}angular.module("musicProjectApp").controller("navigationCtrl",e),e.$inject=["authService","$location"]}();